{% extends 'base.html' %}

{% block title %}My Tasks - HabitFlow{% endblock %}
{% block page_title %}My Tasks{% endblock %}
{% block page_subtitle %}Manage your daily tasks and to-dos{% endblock %}

{% block extra_css %}
<style>
.stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
}

.stat-box {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.filter-tabs {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 6px;
    display: inline-flex;
    gap: 6px;
    margin-bottom: 24px;
}

.filter-tab {
    padding: 8px 18px;
    border-radius: 8px;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    font-weight: 600;
    cursor: pointer;
}

.filter-tab.active {
    background: linear-gradient(135deg, var(--accent-primary), #7c3aed);
    color: #fff;
}

.task-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-left: 4px solid var(--accent-warning);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
}

.task-card.completed {
    opacity: 0.65;
    border-left-color: var(--accent-success);
}

.task-title.completed {
    text-decoration: line-through;
}

.task-actions {
    display: flex;
    gap: 8px;
}
</style>
{% endblock %}

{% block content %}

<!-- HEADER -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">All Tasks</h2>
    <a href="{% url 'todo-create' %}" class="btn btn-primary btn-lg">
        <i class="bi bi-plus-circle"></i> New Task
    </a>
</div>

<!-- STATS -->
<div class="stats-row">
    <div class="stat-box">
        <div class="stat-number text-warning">{{ total_todos }}</div>
        <div class="stat-label">Total Tasks</div>
    </div>
    <div class="stat-box">
        <div class="stat-number text-primary">{{ pending_todos }}</div>
        <div class="stat-label">Pending</div>
    </div>
    <div class="stat-box">
        <div class="stat-number text-success">{{ completed_todos }}</div>
        <div class="stat-label">Completed</div>
    </div>
</div>

<!-- FILTER TABS -->
<div class="filter-tabs">
    <button class="filter-tab active" onclick="filterTasks('all')">All Tasks</button>
    <button class="filter-tab" onclick="filterTasks('pending')">Pending</button>
    <button class="filter-tab" onclick="filterTasks('completed')">Completed</button>
</div>

<!-- TASK LIST -->
<div id="tasks-container">
{% if todos %}
    {% for todo in todos %}
    <div class="task-card {% if todo.completed %}completed{% endif %}"
         data-status="{% if todo.completed %}completed{% else %}pending{% endif %}">

        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h5 class="task-title {% if todo.completed %}completed{% endif %}">
                    {{ todo.title }}
                </h5>

                {% if todo.description %}
                <p class="text-secondary small mb-1">
                    {{ todo.description }}
                </p>
                {% endif %}
            </div>

            <!-- ACTION BUTTONS -->
            <div class="task-actions">

                <!-- COMPLETE / REVERT -->
                <form method="POST" action="{% url 'todo-toggle' todo.pk %}">
                    {% csrf_token %}
                    <button type="submit"
                            class="btn btn-sm {% if todo.completed %}btn-warning{% else %}btn-success{% endif %}"
                            title="{% if todo.completed %}Revert{% else %}Complete{% endif %}">
                        {% if todo.completed %}
                            <i class="bi bi-arrow-counterclockwise"></i>
                        {% else %}
                            <i class="bi bi-check-lg"></i>
                        {% endif %}
                    </button>
                </form>

                <!-- DELETE -->
                <form method="POST" action="{% url 'todo-delete' todo.pk %}">
                    {% csrf_token %}
                    <button type="submit"
                            class="btn btn-sm btn-danger"
                            onclick="return confirm('Delete this task?')"
                            title="Delete">
                        <i class="bi bi-trash"></i>
                    </button>
                </form>

            </div>
        </div>

    </div>
    {% endfor %}
{% else %}
    <div class="text-center p-5">
        <h4>No Tasks Yet</h4>
        <p class="text-secondary">Create your first task to get started</p>
        <a href="{% url 'todo-create' %}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Create Task
        </a>
    </div>
{% endif %}
</div>

{% endblock %}

{% block extra_js %}
<script>
function filterTasks(filter) {
    document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
    event.target.classList.add('active');

    document.querySelectorAll('.task-card').forEach(task => {
        if (filter === 'all' || task.dataset.status === filter) {
            task.style.display = 'block';
        } else {
            task.style.display = 'none';
        }
    });
}
</script>
{% endblock %}
